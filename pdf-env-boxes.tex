% pdf-env-boxes.tex — עטיפת סביבות LaTeX קיימות עם tcolorbox, בלי ארגומנט חובה
\usepackage{amsthm}
\usepackage[most]{tcolorbox}
\tcbuselibrary{theorems,skins,breakable,hooks}

% שמות עבריים
\providecommand{\definitionname}{הגדרה}
\providecommand{\examplename}{דוגמה}
\providecommand{\exercisename}{תרגיל}
\providecommand{\remarkname}{הערה}
\providecommand{\theoremname}{משפט}
\providecommand{\lemmaname}{למה}
\providecommand{\propositionname}{טענה}
\providecommand{\corollaryname}{מסקנה}
\renewcommand{\proofname}{הוכחה}

% סגנון בסיסי לתיבה
\tcbset{
  envbox/.style={
    enhanced, breakable, sharp corners,
    boxrule=0.4pt,
    colback=white,
    fonttitle=\bfseries\small,
    coltitle=black,
    title filled,
    left=8pt,right=8pt,top=6pt,bottom=6pt,
    before skip=10pt, after skip=10pt
  },
}

\makeatletter
% נקבע הורה למספור: ב-book לפי chapter, אחרת section
\@ifundefined{c@chapter}{\def\qnumwithin{section}}{\def\qnumwithin{chapter}}

% אם סביבה לא מוגדרת — נגדיר אותה עם amsthm (שאינו דורש ארגומנט כותרת)
\newcommand{\EnsureNewTheorem}[2]{%
  \@ifundefined{#1}{%
    \newtheorem{#1}{#2}[\qnumwithin]%
  }{}%
}
\makeatother

% מגדירים (אם חסר) ואז עוטפים ב-tcolorbox — זה לא מוסיף דרישה לארגומנט
\AtBeginDocument{%
  % הגדרות בסיסיות (אם חסרות)
  \theoremstyle{definition}
  \EnsureNewTheorem{definition}{\definitionname}
  % --- כותרת ממוספרת ל"definition" בתוך פס הכותרת ---
  \makeatletter
  \renewenvironment{definition}
  {%
    \refstepcounter{definition}% מעלה מונה ומאפשר \label
    \begin{tcolorbox}[envbox,
      colframe=blue!70!black, colbacktitle=blue!15,
      borderline south={0.4pt}{0pt}{blue!70!black},
      title={\definitionname~\thedefinition}%
    ]%
    \ignorespaces
  }{%
    \end{tcolorbox}%
  }
  \makeatother

  \EnsureNewTheorem{example}{\examplename}
  \EnsureNewTheorem{exercise}{\exercisename}

  \theoremstyle{remark}
  \EnsureNewTheorem{remark}{\remarkname}

  \theoremstyle{plain}
  \EnsureNewTheorem{theorem}{\theoremname}
  \EnsureNewTheorem{lemma}{\lemmaname}
  \EnsureNewTheorem{proposition}{\propositionname}
  \EnsureNewTheorem{corollary}{\corollaryname}

  % עטיפות tcolorbox עם כותרת קבועה (אין צורך בארגומנט ב-\begin{...})
  %\tcolorboxenvironment{definition}{envbox,
   % colframe=blue!70!black, colbacktitle=blue!15,
    %borderline south={0.4pt}{0pt}{blue!70!black},
    %title={\definitionname}}

  \tcolorboxenvironment{example}{envbox,
    colframe=teal!70!black, colbacktitle=teal!15,
    borderline south={0.4pt}{0pt}{teal!70!black},
    title={\examplename}}

  \tcolorboxenvironment{exercise}{envbox,
    colframe=orange!80!black, colbacktitle=orange!20,
    borderline south={0.4pt}{0pt}{orange!80!black},
    title={\exercisename}}

  \tcolorboxenvironment{remark}{envbox,
    colframe=gray!70!black, colbacktitle=gray!15,
    borderline south={0.4pt}{0pt}{gray!70!black},
    title={\remarkname}}

  \tcolorboxenvironment{theorem}{envbox,
    colframe=black, colbacktitle=black!10,
    borderline south={0.4pt}{0pt}{black},
    title={\theoremname}}

  \tcolorboxenvironment{lemma}{envbox,
    colframe=black!80, colbacktitle=black!15,
    borderline south={0.4pt}{0pt}{black!80},
    title={\lemmaname}}

  \tcolorboxenvironment{proposition}{envbox,
    colframe=black!80, colbacktitle=black!15,
    borderline south={0.4pt}{0pt}{black!80},
    title={\propositionname}}

  \tcolorboxenvironment{corollary}{envbox,
    colframe=black!80, colbacktitle=black!15,
    borderline south={0.4pt}{0pt}{black!80},
    title={\corollaryname}}

  % proof כבר קיים ב-amsthm — רק עטיפה
  \tcolorboxenvironment{proof}{envbox,
    colframe=purple!70!black, colbacktitle=purple!20,
    borderline south={0.4pt}{0pt}{purple!70!black},
    title={\proofname}}
}
